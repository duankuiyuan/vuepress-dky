<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>js 基本原理 | 蛮大人</title>
    <meta name="description" content="小前端">
    <meta name="generator" content="VuePress 1.4.0">
    
    
    <link rel="preload" href="/vuepress/assets/css/0.styles.f005a01f.css" as="style"><link rel="preload" href="/vuepress/assets/js/app.aa1bee58.js" as="script"><link rel="preload" href="/vuepress/assets/js/2.ab0bcb78.js" as="script"><link rel="preload" href="/vuepress/assets/js/4.d6beed0a.js" as="script"><link rel="prefetch" href="/vuepress/assets/js/10.c5abc53b.js"><link rel="prefetch" href="/vuepress/assets/js/11.b35fca6d.js"><link rel="prefetch" href="/vuepress/assets/js/12.d899b9bd.js"><link rel="prefetch" href="/vuepress/assets/js/13.ff0013f1.js"><link rel="prefetch" href="/vuepress/assets/js/14.1690abc6.js"><link rel="prefetch" href="/vuepress/assets/js/15.524f82eb.js"><link rel="prefetch" href="/vuepress/assets/js/16.6d037b24.js"><link rel="prefetch" href="/vuepress/assets/js/17.3c57689e.js"><link rel="prefetch" href="/vuepress/assets/js/18.690ce4a6.js"><link rel="prefetch" href="/vuepress/assets/js/19.7d9441bf.js"><link rel="prefetch" href="/vuepress/assets/js/20.b293583f.js"><link rel="prefetch" href="/vuepress/assets/js/21.b330ad94.js"><link rel="prefetch" href="/vuepress/assets/js/22.1734b572.js"><link rel="prefetch" href="/vuepress/assets/js/23.f185bcb8.js"><link rel="prefetch" href="/vuepress/assets/js/24.c7e882b0.js"><link rel="prefetch" href="/vuepress/assets/js/25.0be67e0d.js"><link rel="prefetch" href="/vuepress/assets/js/26.d5ed1cc3.js"><link rel="prefetch" href="/vuepress/assets/js/27.696d02f7.js"><link rel="prefetch" href="/vuepress/assets/js/28.d2aa13c6.js"><link rel="prefetch" href="/vuepress/assets/js/29.7eb7ca43.js"><link rel="prefetch" href="/vuepress/assets/js/3.4784a526.js"><link rel="prefetch" href="/vuepress/assets/js/30.0e88eb1b.js"><link rel="prefetch" href="/vuepress/assets/js/31.622a7556.js"><link rel="prefetch" href="/vuepress/assets/js/32.035a4957.js"><link rel="prefetch" href="/vuepress/assets/js/33.2b836a8b.js"><link rel="prefetch" href="/vuepress/assets/js/34.05131964.js"><link rel="prefetch" href="/vuepress/assets/js/35.d68e2ecf.js"><link rel="prefetch" href="/vuepress/assets/js/36.5eb2fecb.js"><link rel="prefetch" href="/vuepress/assets/js/37.cd6ea64d.js"><link rel="prefetch" href="/vuepress/assets/js/38.0deac3fe.js"><link rel="prefetch" href="/vuepress/assets/js/39.b68eda0d.js"><link rel="prefetch" href="/vuepress/assets/js/40.f383810c.js"><link rel="prefetch" href="/vuepress/assets/js/5.9183340f.js"><link rel="prefetch" href="/vuepress/assets/js/6.51fd30be.js"><link rel="prefetch" href="/vuepress/assets/js/7.c4e6ed77.js"><link rel="prefetch" href="/vuepress/assets/js/8.5603b430.js"><link rel="prefetch" href="/vuepress/assets/js/9.3db12add.js">
    <link rel="stylesheet" href="/vuepress/assets/css/0.styles.f005a01f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/vuepress/" class="home-link router-link-active"><!----> <span class="site-name">蛮大人</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/vuepress/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/vuepress/jsBasic/" class="nav-link router-link-active">
  jvascript
</a></div><div class="nav-item"><a href="/vuepress/htmlcss/" class="nav-link">
  html+css
</a></div><div class="nav-item"><a href="/vuepress/vue/" class="nav-link">
  Vue
</a></div><div class="nav-item"><a href="/vuepress/react/" class="nav-link">
  React
</a></div><div class="nav-item"><a href="/vuepress/node/" class="nav-link">
  node
</a></div><div class="nav-item"><a href="/vuepress/design/" class="nav-link">
  前端设计模式
</a></div><div class="nav-item"><a href="/vuepress/structrue/" class="nav-link">
  数据结构与算法
</a></div><div class="nav-item"><a href="/vuepress/tool/" class="nav-link">
  工具
</a></div><div class="nav-item"><a href="/vuepress/net/" class="nav-link">
  网络
</a></div><div class="nav-item"><a href="/vuepress/interview/" class="nav-link">
  面试问题
</a></div><div class="nav-item"><a href="/vuepress/server/" class="nav-link">
  服务器
</a></div><div class="nav-item"><a href="/vuepress/other/" class="nav-link">
  其他
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/vuepress/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/vuepress/jsBasic/" class="nav-link router-link-active">
  jvascript
</a></div><div class="nav-item"><a href="/vuepress/htmlcss/" class="nav-link">
  html+css
</a></div><div class="nav-item"><a href="/vuepress/vue/" class="nav-link">
  Vue
</a></div><div class="nav-item"><a href="/vuepress/react/" class="nav-link">
  React
</a></div><div class="nav-item"><a href="/vuepress/node/" class="nav-link">
  node
</a></div><div class="nav-item"><a href="/vuepress/design/" class="nav-link">
  前端设计模式
</a></div><div class="nav-item"><a href="/vuepress/structrue/" class="nav-link">
  数据结构与算法
</a></div><div class="nav-item"><a href="/vuepress/tool/" class="nav-link">
  工具
</a></div><div class="nav-item"><a href="/vuepress/net/" class="nav-link">
  网络
</a></div><div class="nav-item"><a href="/vuepress/interview/" class="nav-link">
  面试问题
</a></div><div class="nav-item"><a href="/vuepress/server/" class="nav-link">
  服务器
</a></div><div class="nav-item"><a href="/vuepress/other/" class="nav-link">
  其他
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/vuepress/jsBasic/" class="sidebar-link">javascript</a></li><li><a href="/vuepress/jsBasic/jsBasic.html" class="sidebar-link">js 基础</a></li><li><a href="/vuepress/jsBasic/jsTheory.html" class="active sidebar-link">js 基本原理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuepress/jsBasic/jsTheory.html#_1-js作用域、预编译、作用域链、闭包" class="sidebar-link">1 js作用域、预编译、作用域链、闭包</a></li><li class="sidebar-sub-header"><a href="/vuepress/jsBasic/jsTheory.html#_1-1js作用域" class="sidebar-link">1.1js作用域</a></li><li class="sidebar-sub-header"><a href="/vuepress/jsBasic/jsTheory.html#_2-js原型、原型链、继承" class="sidebar-link">2 js原型、原型链、继承</a></li><li class="sidebar-sub-header"><a href="/vuepress/jsBasic/jsTheory.html#_3-1-this概述" class="sidebar-link">3.1 this概述</a></li><li class="sidebar-sub-header"><a href="/vuepress/jsBasic/jsTheory.html#_3-1-1-this全局环境" class="sidebar-link">3.1.1 this全局环境</a></li><li class="sidebar-sub-header"><a href="/vuepress/jsBasic/jsTheory.html#_3-1-2-this函数（运行内）环境" class="sidebar-link">3.1.2 this函数（运行内）环境</a></li><li class="sidebar-sub-header"><a href="/vuepress/jsBasic/jsTheory.html#_3-2-javascript-this的原理（阮一峰版）" class="sidebar-link">3.2 javascript this的原理（阮一峰版）</a></li><li class="sidebar-sub-header"><a href="/vuepress/jsBasic/jsTheory.html#_3-3-js-this-之-call" class="sidebar-link">3.3 js this 之 call</a></li><li class="sidebar-sub-header"><a href="/vuepress/jsBasic/jsTheory.html#_3-4-js-this-之-apply" class="sidebar-link">3.4 js this 之 apply</a></li><li class="sidebar-sub-header"><a href="/vuepress/jsBasic/jsTheory.html#_3-5-js-this-之-bind" class="sidebar-link">3.5 js this 之 bind</a></li><li class="sidebar-sub-header"><a href="/vuepress/jsBasic/jsTheory.html#_4-页面加载" class="sidebar-link">4 页面加载</a></li><li class="sidebar-sub-header"><a href="/vuepress/jsBasic/jsTheory.html#_5-浏览器事件环" class="sidebar-link">5 浏览器事件环</a></li><li class="sidebar-sub-header"><a href="/vuepress/jsBasic/jsTheory.html#_6-事件流" class="sidebar-link">6 事件流</a></li></ul></li><li><a href="/vuepress/jsBasic/promise.html" class="sidebar-link">Promise</a></li><li><a href="/vuepress/jsBasic/es6.html" class="sidebar-link">es6</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="js-基本原理"><a href="#js-基本原理" class="header-anchor">#</a> js 基本原理</h1> <h2 id="_1-js作用域、预编译、作用域链、闭包"><a href="#_1-js作用域、预编译、作用域链、闭包" class="header-anchor">#</a> 1 js作用域、预编译、作用域链、闭包</h2> <h2 id="_1-1js作用域"><a href="#_1-1js作用域" class="header-anchor">#</a> 1.1js作用域</h2> <h2 id="_2-js原型、原型链、继承"><a href="#_2-js原型、原型链、继承" class="header-anchor">#</a> 2 js原型、原型链、继承</h2> <h2 id="_3-1-this概述"><a href="#_3-1-this概述" class="header-anchor">#</a> 3.1 this概述</h2> <ul><li>在绝大多数情况下，函数的调用方式决定了this的值。this不能在执行期间被赋值，并且在每次函数被调用时this的值也可能会不同，es5引入bind的方法来设置函数的this的值，而不用考虑函数是如何被调用的，es6引入了支持词法分析的箭头函数（它在闭合的执行环境内设置this的值）</li> <li>javascript函数中的this并不是函数定义时候确定的，而是在函数调用的时候确定的。换句话说，函数的调用方式决定了this的指向。</li></ul> <h2 id="_3-1-1-this全局环境"><a href="#_3-1-1-this全局环境" class="header-anchor">#</a> 3.1.1 this全局环境</h2> <ul><li>无论是否在严格模式下，在全局执行环境中（在任何函数体外部）this 都指向全局对象。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token comment">// 在浏览器中, window 对象同时也是全局对象：</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token operator">===</span> window<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>

a <span class="token operator">=</span> <span class="token string">'蛮大人'</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 蛮大人</span>

<span class="token keyword">this</span><span class="token punctuation">.</span>b <span class="token operator">=</span> <span class="token string">&quot;mdr&quot;</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>b<span class="token punctuation">)</span>  <span class="token comment">// &quot;mdr&quot;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span>         <span class="token comment">// &quot;mdr&quot;</span>
</code></pre></div><div class="custom-block danger"><p class="custom-block-title">提示</p> <p>你可以使用 globalThis 获取全局对象，无论你的代码是否在当前上下文运行。</p></div> <h2 id="_3-1-2-this函数（运行内）环境"><a href="#_3-1-2-this函数（运行内）环境" class="header-anchor">#</a> 3.1.2 this函数（运行内）环境</h2> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>在函数内部，this的值取决于函数被调用的方式。</p></div> <h3 id="_1-简单调用-直接调用"><a href="#_1-简单调用-直接调用" class="header-anchor">#</a> 1) 简单调用(直接调用)</h3> <ul><li>在非严格模式下，函数没有被任何对象调用，所以this默认指向全局对象</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">f1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//在浏览器中：</span>
<span class="token function">f1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> window<span class="token punctuation">;</span>   <span class="token comment">//在浏览器中，全局对象是window</span>

<span class="token comment">//在Node中：</span>
<span class="token function">f1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> global<span class="token punctuation">;</span>  
</code></pre></div><ul><li>在严格模式下，如果 this 没有被执行环境（execution context）定义，那它将保持为 undefined;this的确应该是undefined，因为f2是被直接调用的，而不是作为对象的属性或方法调用的（如 window.f2()）</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">f2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token string">&quot;use strict&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 这里是严格模式</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">f2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span> <span class="token comment">// true </span>
</code></pre></div><ul><li>如果要想把 this 的值从一个环境传到另一个，就要用 call 或者apply 方法。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 将一个对象作为call和apply的第一个参数，this会被绑定到这个对象。</span>
<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>a<span class="token operator">:</span> <span class="token string">'Custom'</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 这个属性是在global对象定义的。</span>
<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token string">'Global'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">whatsThis</span><span class="token punctuation">(</span><span class="token parameter">arg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>a<span class="token punctuation">;</span>  <span class="token comment">// this的值取决于函数的调用方式</span>
<span class="token punctuation">}</span>

<span class="token function">whatsThis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment">// 'Global'</span>
<span class="token function">whatsThis</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 'Custom'</span>
<span class="token function">whatsThis</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 'Custom'</span>
</code></pre></div><ul><li>当一个函数在其主体中使用 this 关键字时，可以通过使用函数继承自Function.prototype 的 call 或 apply 方法将 this 值绑定到调用中的特定对象。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">c<span class="token punctuation">,</span> d</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>a <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>b <span class="token operator">+</span> c <span class="token operator">+</span> d<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> o <span class="token operator">=</span> <span class="token punctuation">{</span>a<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 第一个参数是作为‘this’使用的对象</span>
<span class="token comment">// 后续参数作为参数传递给函数调用</span>
<span class="token function">add</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>o<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1 + 3 + 5 + 7 = 16</span>

<span class="token comment">// 第一个参数也是作为‘this’使用的对象</span>
<span class="token comment">// 第二个参数是一个数组，数组里的元素用作函数调用中的参数</span>
<span class="token function">add</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>o<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1 + 3 + 10 + 20 = 34</span>
</code></pre></div><div class="custom-block danger"><p class="custom-block-title">提示</p> <p>使用 call 和 apply 函数的时候要注意，如果传递给 this 的值不是一个对象，JavaScript 会尝试使用内部 ToObject 操作将其转换为对象。因此，如果传递的值是一个原始值比如 7 或 'foo'，那么就会使用相关构造函数将它转换为对象，所以原始值 7 会被转换为对象，像 new Number(7) 这样，而字符串 'foo' 转化成 new String('foo') 这样，例如：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//原始值 7 被隐式转换为对象</span>
<span class="token function">bar</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [object Number]</span>
<span class="token function">bar</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [object String]</span>
</code></pre></div></div> <h3 id="_2-bind调用"><a href="#_2-bind调用" class="header-anchor">#</a> 2) bind调用</h3> <ul><li>ECMAScript 5 引入了 Function.prototype.bind()。调用f.bind(someObject)会创建一个与f具有相同函数体和作用域的函数，但是在这个新函数中，this将永久地被绑定到了bind的第一个参数，无论这个函数是如何被调用的</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>a<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> g <span class="token operator">=</span> <span class="token function">f</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token punctuation">{</span>a<span class="token operator">:</span><span class="token string">&quot;azerty&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">g</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// azerty</span>

<span class="token keyword">var</span> h <span class="token operator">=</span> <span class="token function">g</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token punctuation">{</span>a<span class="token operator">:</span><span class="token string">'yoo'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// bind只生效一次！</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">h</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// azerty</span>

<span class="token keyword">var</span> o <span class="token operator">=</span> <span class="token punctuation">{</span>a<span class="token operator">:</span><span class="token number">37</span><span class="token punctuation">,</span> f<span class="token operator">:</span>f<span class="token punctuation">,</span> g<span class="token operator">:</span>g<span class="token punctuation">,</span> h<span class="token operator">:</span>h<span class="token punctuation">}</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>o<span class="token punctuation">.</span>a<span class="token punctuation">,</span> o<span class="token punctuation">.</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> o<span class="token punctuation">.</span><span class="token function">g</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> o<span class="token punctuation">.</span><span class="token function">h</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 37, 37, azerty, azerty</span>
</code></pre></div><h3 id="_3-箭头函数"><a href="#_3-箭头函数" class="header-anchor">#</a> 3) 箭头函数</h3> <ul><li>在箭头函数中，this与封闭词法环境的this保持一致。在全局代码中，它将被设置为全局对象：</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> globalObject <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> foo <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> globalObject<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token comment">// 作为对象的一个方法调用</span>
<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>foo<span class="token operator">:</span> foo<span class="token punctuation">}</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> globalObject<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>

<span class="token comment">// 尝试使用call来设定this</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">foo</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token operator">===</span> globalObject<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>

<span class="token comment">// 尝试使用bind来设定this</span>
foo <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> globalObject<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
</code></pre></div><div class="custom-block danger"><p class="custom-block-title">提示</p> <p>注意：如果将this传递给call、bind、或者apply，它将被忽略。不过你仍然可以为调用添加参数，不过第一个参数（thisArg）应该设置为null。</p></div> <ul><li>无论如何，foo 的 this 被设置为他被创建时的环境（在上面的例子中，就是全局对象）。这同样适用于在其他函数内创建的箭头函数：这些箭头函数的this被设置为封闭的词法环境的。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 创建一个含有bar方法的obj对象，</span>
<span class="token comment">// bar返回一个函数，</span>
<span class="token comment">// 这个函数返回this，</span>
<span class="token comment">// 这个返回的函数是以箭头函数创建的，</span>
<span class="token comment">// 所以它的this被永久绑定到了它外层函数的this。</span>
<span class="token comment">// bar的值可以在调用中设置，这反过来又设置了返回函数的值。</span>
<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">bar</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> x<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 作为obj对象的一个方法来调用bar，把它的this绑定到obj。</span>
<span class="token comment">// 将返回的函数的引用赋值给fn。</span>
<span class="token keyword">var</span> fn <span class="token operator">=</span> obj<span class="token punctuation">.</span><span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 直接调用fn而不设置this，</span>
<span class="token comment">// 通常(即不使用箭头函数的情况)默认为全局对象</span>
<span class="token comment">// 若在严格模式则为undefined</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> obj<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>

<span class="token comment">// 但是注意，如果你只是引用obj的方法，</span>
<span class="token comment">// 而没有调用它</span>
<span class="token keyword">var</span> fn2 <span class="token operator">=</span> obj<span class="token punctuation">.</span>bar<span class="token punctuation">;</span>
<span class="token comment">// 那么调用箭头函数后，this指向window，因为它从 bar 继承了this。</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">fn2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> window<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
</code></pre></div><h3 id="_4-作为对象的方法"><a href="#_4-作为对象的方法" class="header-anchor">#</a> 4) 作为对象的方法</h3> <ul><li>当函数作为对象里的方法被调用时，它们的 this 是调用该函数的对象。</li></ul> <h3 id="_5-原型链中的-this"><a href="#_5-原型链中的-this" class="header-anchor">#</a> 5) 原型链中的 this</h3> <ul><li>对于在对象原型链上某处定义的方法。如果该方法存在于一个对象的原型链上，那么this指向的是调用这个方法的对象，就像该方法在对象上一样。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> o <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">f</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>a <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>b<span class="token punctuation">;</span> 
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> p <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span>
p<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
p<span class="token punctuation">.</span>b <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 5</span>
</code></pre></div><div class="custom-block danger"><p class="custom-block-title">提示</p> <p>在这个例子中，对象p没有属于它自己的f属性，它的f属性继承自它的原型。虽然在对 f 的查找过程中，最终是在 o 中找到 f 属性的，这并没有关系；查找过程首先从 p.f 的引用开始，所以函数中的 this 指向p。也就是说，因为f是作为p的方法调用的，所以它的this指向了p。这是 JavaScript 的原型继承中的一个有趣的特性。</p></div> <h3 id="_6-getter-与-setter-中的-this"><a href="#_6-getter-与-setter-中的-this" class="header-anchor">#</a> 6) getter 与 setter 中的 this</h3> <ul><li>相同的概念也适用于当函数在一个 getter 或者 setter 中被调用。用作 getter 或 setter 的函数都会把 this 绑定到设置或获取属性的对象。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>a <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>b <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>c<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> o <span class="token operator">=</span> <span class="token punctuation">{</span>
  a<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  b<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
  c<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
  <span class="token keyword">get</span> <span class="token function">average</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>a <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>b <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>c<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">3</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>o<span class="token punctuation">,</span> <span class="token string">'sum'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token keyword">get</span><span class="token operator">:</span> sum<span class="token punctuation">,</span> enumerable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> configurable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>o<span class="token punctuation">.</span>average<span class="token punctuation">,</span> o<span class="token punctuation">.</span>sum<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// logs 2, 6</span>
</code></pre></div><h3 id="_7-构造函数"><a href="#_7-构造函数" class="header-anchor">#</a> 7) 构造函数</h3> <ul><li>当一个函数用作构造函数时（使用new关键字），它的this被绑定到正在构造的新对象。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/*
 * 构造函数这样工作:
 *
 * function MyConstructor(){
 *   // 函数实体写在这里
 *   // 根据需要在this上创建属性，然后赋值给它们，比如：
 *   this.fum = &quot;nom&quot;;
 *   // 等等...
 *
 *   // 如果函数具有返回对象的return语句，
 *   // 则该对象将是 new 表达式的结果。 
 *   // 否则，表达式的结果是当前绑定到 this 的对象。
 *   //（即通常看到的常见情况）。
 * }
 */</span>

<span class="token keyword">function</span> <span class="token constant">C</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">37</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> o <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">C</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>o<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// logs 37</span>


<span class="token keyword">function</span> <span class="token constant">C2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">37</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>a<span class="token operator">:</span><span class="token number">38</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

o <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">C2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>o<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// logs 38</span>

</code></pre></div><div class="custom-block danger"><p class="custom-block-title">提示</p> <p>虽然构造器返回的默认值是this所指的那个对象，但它仍可以手动返回其他的对象（如果返回值不是一个对象，则返回this对象）。
在刚刚的例子中（C2），因为在调用构造函数的过程中，手动的设置了返回对象，与this绑定的默认对象被丢弃了。（这基本上使得语句 “this.a = 37;”成了“僵尸”代码，实际上并不是真正的“僵尸”，这条语句执行了，但是对于外部没有任何影响，因此完全可以忽略它）。</p></div> <h2 id="_3-2-javascript-this的原理（阮一峰版）"><a href="#_3-2-javascript-this的原理（阮一峰版）" class="header-anchor">#</a> 3.2 javascript this的原理（阮一峰版）</h2> <h4 id="（1）问题的由来"><a href="#（1）问题的由来" class="header-anchor">#</a> （1）问题的由来</h4> <div class="language-js extra-class"><pre class="language-js"><code>    <span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">foo</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>bar<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    bar<span class="token operator">:</span> <span class="token number">1</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> foo <span class="token operator">=</span> obj<span class="token punctuation">.</span>foo<span class="token punctuation">;</span>
    <span class="token keyword">var</span> bar <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>

    obj<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 1</span>
    <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 2</span>
</code></pre></div><div class="custom-block danger"><p class="custom-block-title">提示</p> <p>obj.foo()就是在obj环境执行，this指向obj，而一旦var foo = obj.foo，foo()就变成在全局环境执行this执行window；why？</p></div> <h4 id="（2）内存的数据结构"><a href="#（2）内存的数据结构" class="header-anchor">#</a> （2）内存的数据结构</h4> <ul><li>JavaScript 语言之所以有this的设计，跟内存里面的数据结构有关系。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span> foo<span class="token operator">:</span>  <span class="token number">5</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><div class="custom-block danger"><p class="custom-block-title">提示</p> <p>上面的代码将一个对象赋值给变量obj。JavaScript 引擎会先在内存里面，生成一个对象{ foo: 5 }，然后把这个对象的内存地址赋值给变量obj。
<img src="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/2wBDAAIBAQIBAQICAgICAgICAwUDAwMDAwYEBAMFBwYHBwcGBwcICQsJCAgKCAcHCg0KCgsMDAwMBwkODw0MDgsMDAz/2wBDAQICAgMDAwYDAwYMCAcIDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAz/wAARCAC7AfgDASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oADAMBAAIRAxEAPwD9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACvzA/4LV/8HIX/AA58/an0D4Z/8Ka/4WJ/bnhS38T/ANpf8Jb/AGR5Hm3l5beR5X2Kfdj7Ju37xnzMbRtyf0/r+YH/AIPVv+UpvgH/ALJVp3/p31igD6A/4jnP+rXf/Mkf/euj/iOc/wCrXf8AzJH/AN66/X//AIdO/ssf9G0/s/8A/hvNI/8Akej/AIdO/ssf9G0/s/8A/hvNI/8AkegD8gP+I5z/AKtd/wDMkf8A3ro/4jnP+rXf/Mkf/euv1/8A+HTv7LH/AEbT+z//AOG80j/5Ho/4dO/ssf8ARtP7P/8A4bzSP/kegD8gP+I5z/q13/zJH/3ro/4jnP8Aq13/AMyR/wDeuv1//wCHTv7LH/RtP7P/AP4bzSP/AJHo/wCHTv7LH/RtP7P/AP4bzSP/AJHoA/ID/iOc/wCrXf8AzJH/AN66P+I5z/q13/zJH/3rr9f/APh07+yx/wBG0/s//wDhvNI/+R6P+HTv7LH/AEbT+z//AOG80j/5HoA/ID/iOc/6td/8yR/966P+I5z/AKtd/wDMkf8A3rr9f/8Ah07+yx/0bT+z/wD+G80j/wCR6P8Ah07+yx/0bT+z/wD+G80j/wCR6APyA/4jnP8Aq13/AMyR/wDeuj/iOc/6td/8yR/966/X/wD4dO/ssf8ARtP7P/8A4bzSP/kej/h07+yx/wBG0/s//wDhvNI/+R6APyA/4jnP+rXf/Mkf/euj/iOc/wCrXf8AzJH/AN66/X//AIdO/ssf9G0/s/8A/hvNI/8Akej/AIdO/ssf9G0/s/8A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/Ev4f/ET+w/+Em/tL/hGPENnq/8AZ/m/2R5XnfZ5H8vf5Um3djd5b4ztOP2//wCCTv8Ayiy/Zp/7JV4X/wDTRa1+QH/EDH/1dF/5jf8A++lft9+yd8C/+GX/ANlj4afDP+1P7c/4V34U0vwx/aX2b7N/aH2KzitvP8re/l7/ACt2ze23djc2MkA9AooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD//Z" alt="An image"></p> <p>也就是说，变量obj是一个地址（reference）。后面如果要读取obj.foo，引擎先从obj拿到内存地址，然后再从该地址读出原始的对象，返回它的foo属性。
原始的对象以字典结构保存，每一个属性名都对应一个属性描述对象。举例来说，上面例子的foo属性，实际上是以下面的形式保存的。</p> <p><img src="/vuepress/assets/img/this2.93d0ccce.jpg" alt="An image"></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  foo<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token punctuation">[</span>value<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token number">5</span>
    <span class="token punctuation">[</span><span class="token punctuation">[</span>writable<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">[</span><span class="token punctuation">[</span>enumerable<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">[</span><span class="token punctuation">[</span>configurable<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>注意，foo属性的值保存在属性描述对象的value属性里面。</p></div> <h4 id="（3）函数"><a href="#（3）函数" class="header-anchor">#</a> （3）函数</h4> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">foo</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre></div><div class="custom-block danger"><p class="custom-block-title">提示</p> <p>这样的结构是很清晰的，问题在于属性的值可能是一个函数 如上所示；这时，引擎会将函数单独保存在内存中，然后再将函数的地址赋值给foo属性的value属性。</p> <p><img src="/vuepress/assets/img/this3.dc46cd4d.jpg" alt="An image"></p></div> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token punctuation">{</span>
  foo<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token punctuation">[</span>value<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">:</span> 函数的地址
    <span class="token operator">...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>由于函数是一个单独的值，所以它可以在不同的环境（上下文）执行。</p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token keyword">var</span> <span class="token function-variable function">f</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span> f<span class="token operator">:</span> f <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token comment">// 单独执行</span>
  <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">// obj 环境执行</span>
  obj<span class="token punctuation">.</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="（4）环境变量"><a href="#（4）环境变量" class="header-anchor">#</a> （4）环境变量</h4> <ul><li>JavaScript 允许在函数体内部，引用当前环境的其他变量。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">f</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><div class="custom-block danger"><p class="custom-block-title">提示</p> <ul><li>上面代码中，函数体里面使用了变量x。该变量由运行环境提供。</li> <li>现在问题就来了，由于函数可以在不同的运行环境执行，所以需要有一种机制，能够在函数体内部获得当前的运行环境（context）。所以，this就出现了，它的设计目的就是在函数体内部，指代函数当前的运行环境。</li></ul></div> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">f</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block danger"><p class="custom-block-title">提示</p> <ul><li>上面代码中，函数体里面的this.x就是指当前运行环境的x。</li></ul></div> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token keyword">var</span> <span class="token function-variable function">f</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  f<span class="token operator">:</span> f<span class="token punctuation">,</span>
  x<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 单独执行</span>
<span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 1</span>

<span class="token comment">// obj 环境执行</span>
obj<span class="token punctuation">.</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 2onsole.log(this.x);</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block danger"><p class="custom-block-title">提示</p> <ul><li>上面代码中，函数f在全局环境执行，this.x指向全局环境的x。</li> <li>在obj环境执行，this.x指向obj.x。</li> <li>回到本文开头提出的问题，obj.foo()是通过obj找到foo，所以就是在obj环境执行。一旦var foo = obj.foo，变量foo就直接指向函数本身，所以foo()就变成在全局环境执行。</li></ul></div> <h2 id="_3-3-js-this-之-call"><a href="#_3-3-js-this-之-call" class="header-anchor">#</a> 3.3 js this 之 call</h2> <h3 id="call方法用来执行方法并且改变方法内的this，第一个参数是新的this，后面参数为方法的参数，用逗号隔开"><a href="#call方法用来执行方法并且改变方法内的this，第一个参数是新的this，后面参数为方法的参数，用逗号隔开" class="header-anchor">#</a> call方法用来执行方法并且改变方法内的this，第一个参数是新的this，后面参数为方法的参数，用逗号隔开</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//                                   新的this   其他参数</span>
<span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">myCall</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">content<span class="token punctuation">,</span><span class="token operator">...</span>args</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">let</span> fn <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> new_this <span class="token operator">=</span> content <span class="token operator">||</span> window<span class="token punctuation">;</span>
  new_this<span class="token punctuation">.</span>fn <span class="token operator">=</span> fn<span class="token punctuation">;</span>
  <span class="token keyword">return</span> new_this<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span><span class="token string">&quot;蛮大人&quot;</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> <span class="token function-variable function">fn</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//蛮大人</span>
<span class="token punctuation">}</span>
fn<span class="token punctuation">.</span><span class="token function">myCall</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_3-4-js-this-之-apply"><a href="#_3-4-js-this-之-apply" class="header-anchor">#</a> 3.4 js this 之 apply</h2> <h3 id="apply方法用来执行方法并且改变方法内的this，第一个参数是新的this，后面的参数为一个数组"><a href="#apply方法用来执行方法并且改变方法内的this，第一个参数是新的this，后面的参数为一个数组" class="header-anchor">#</a> apply方法用来执行方法并且改变方法内的this，第一个参数是新的this，后面的参数为一个数组</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">myApply</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">content<span class="token punctuation">,</span><span class="token operator">...</span>args</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">let</span> fn <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> newthis <span class="token operator">=</span> content <span class="token operator">||</span> window<span class="token punctuation">;</span>
  <span class="token keyword">let</span> arg <span class="token operator">=</span> args <span class="token operator">&amp;&amp;</span> args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  newthis<span class="token punctuation">.</span>fn <span class="token operator">=</span> fn<span class="token punctuation">;</span>
  <span class="token keyword">return</span> newthis<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token operator">...</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span><span class="token string">&quot;蛮大人&quot;</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> <span class="token function-variable function">fn</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">a</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token operator">+</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//蛮大人12</span>
<span class="token punctuation">}</span>
fn<span class="token punctuation">.</span><span class="token function">myApply</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'12'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="_3-5-js-this-之-bind"><a href="#_3-5-js-this-之-bind" class="header-anchor">#</a> 3.5 js this 之 bind</h2> <h3 id="bind"><a href="#bind" class="header-anchor">#</a> bind</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">myBind</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span><span class="token operator">...</span>args</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token keyword">let</span> newthis <span class="token operator">=</span> target<span class="token punctuation">;</span>
   <span class="token keyword">let</span> fn <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
   <span class="token keyword">let</span> arg <span class="token operator">=</span> args <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
   <span class="token keyword">function</span> <span class="token function">newFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">let</span> newArgs <span class="token operator">=</span> <span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">let</span> allArgs <span class="token operator">=</span> arg<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>newArgs<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>newthis<span class="token punctuation">,</span>allArgs<span class="token punctuation">)</span>
   <span class="token punctuation">}</span>
   newFn<span class="token punctuation">.</span>prototype <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">return</span> newFn<span class="token punctuation">;</span>
<span class="token punctuation">}</span> 
<span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span><span class="token string">'蛮大人'</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> <span class="token function-variable function">fn</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span>b</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">+</span> a<span class="token operator">+</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//蛮大人bind第二参</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> newFn <span class="token operator">=</span> fn<span class="token punctuation">.</span><span class="token function">myBind</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span><span class="token string">'bind'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">newFn</span><span class="token punctuation">(</span><span class="token string">'第二参'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="_4-页面加载"><a href="#_4-页面加载" class="header-anchor">#</a> 4 页面加载</h2> <h2 id="_5-浏览器事件环"><a href="#_5-浏览器事件环" class="header-anchor">#</a> 5 浏览器事件环</h2> <h2 id="_6-事件流"><a href="#_6-事件流" class="header-anchor">#</a> 6 事件流</h2></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/vuepress/jsBasic/jsBasic.html" class="prev">
        js 基础
      </a></span> <span class="next"><a href="/vuepress/jsBasic/promise.html">
        Promise
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/vuepress/assets/js/app.aa1bee58.js" defer></script><script src="/vuepress/assets/js/2.ab0bcb78.js" defer></script><script src="/vuepress/assets/js/4.d6beed0a.js" defer></script>
  </body>
</html>
